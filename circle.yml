#
# build configuration for circle CI
#

general:
    artifacts:
       - /home/ubuntu/AndroidCircleCI/app/build/outputs/apk/
       - /home/ubuntu/AndroidCircleCI/app/build/reports/tests/testDebugUnitTest/


    branches:
       only:
          - development
          - /release\/.*/


machine:
    environment:
       ANDROID_HOME: /usr/local/android-sdk-linux


dependencies:
    pre:
      - source circleCIEnvironmentSetup.sh && copyEnvVarsToGradleProperties
    cache_directories:
      - /usr/local/android-sdk-linux/build-tools/25.0.2
      - /usr/local/android-sdk-linux/platforms/android-25
      - /usr/local/android-sdk-linux/extras/android/m2repository

    override:
      - if [ ! -e /usr/local/android-sdk-linux/build-tools/25.0.2 ]; then echo y | android update sdk --all --no-ui --filter "build-tools-25.0.2"; fi;
      - if [ ! -e /usr/local/android-sdk-linux/platforms/android-25 ]; then echo y | android update sdk --all --no-ui --filter "android-25"; fi;
      - if [ ! -e /usr/local/android-sdk-linux/extras/android/m2repository ]; then echo y | android update sdk --all --no-ui --filter "extra-android-m2repository"; fi;
test:
    override:
      - ./gradlew test


deployment:
    development:
       branch: development
       commands:
         - ./gradlew assembleDebug crashlyticsUploadDistributionDebug

    release:
       branch: /release\/.*/
       commands:
        - echo $KEYSTORE64> ${HOME}/keystore64.txt
        - cat ${HOME}/keystore64.txt | base64 --decode > ${HOME}/testkeystore.jks
        - ./gradlew publishRelease

