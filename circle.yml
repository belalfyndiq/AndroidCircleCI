#
# build configuration for circle CI
#

general:
    artifacts:
       - /home/ubuntu/AndroidCircleCI/app/build/outputs/apk/

    branches:
       only:
          - development
          - /release\/.*/


machine:
    environment:
       ANDROID_HOME: /usr/local/android-sdk-linux


dependencies:
    override:
       - echo y | android update sdk --no-ui --all --filter tools,platform-tools,build-tools-25.0.2,extra-google-m2repository,extra-google-google-play-services,extra-android-support
       - ANDROID_HOME=/usr/local/android-sdk-linux ./gradlew dependencies


test:
    pre:
        - emulator -avd circleci-android22 -no-audio -no-window:
              background: true
              parallel: true
        - circle-android wait-for-boot
        # unlock emulator
        - sleep 30
        - adb shell input keyevent 82

      override:
        # This will run the tests:
       - ./gradlew assemble connectedDebugAndroidTest -PdisablePreDex --console=plain --info

      post:
          - cp -r app/build/outputs $CIRCLE_ARTIFACTS
          - cp -r app/build/outputs/androidTest-results/connected/ $CIRCLE_TEST_REPORTS



